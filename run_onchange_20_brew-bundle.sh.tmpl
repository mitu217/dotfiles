{{- if eq .chezmoi.os "darwin" -}}
#!/bin/bash
set -eu

# Brewfile hash: {{ include "dot_Brewfile" | sha256sum }}

echo "==> Running brew bundle..."

if ! command -v brew &> /dev/null; then
    echo "Error: Homebrew is not installed"
    exit 1
fi

# Add Homebrew to PATH for Apple Silicon
if [[ -d /opt/homebrew ]]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
fi

if ! brew bundle --global; then
    echo "Warning: some brew bundle dependencies failed to install (e.g. casks requiring sudo)"
    echo "You can install them manually later with: brew bundle --global"
fi

echo "brew bundle completed"
{{- end }}
